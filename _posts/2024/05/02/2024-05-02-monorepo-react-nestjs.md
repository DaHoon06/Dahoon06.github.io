---
layout: post
title: "모노레포 전환기(FE: React, BE: NestJS)"
summary: "개발 노트"
author: dahoon06
date: "2024-05-02 00:00:00 +0530"
category: development
thumbnail: 
keywords: Monorepo React NestJS
permalink: /blog/development/2024-05-02-monorepo/
usemathjax: true
---

팀 내의 프로젝트의 경우 하나의 프로젝트마다 프론트와 백엔드를 하나의 레포지토리에서 관리하는 멀티레포 방식으로 구성되어있다. 프론트 백엔드 둘 다 타입스크립트 기반이라 매 번 동일한 코드를 작성하는데 (인터페이스, 유틸 함수 등등..) 불편함을 느끼고 있었을 때 팀장님께서 인터페이스만이라도 공유해서 사용하고 싶다고 이야기하셨을 때 어떻게 해야하나.. 고민을 많이 했던 것 같다.       

사실 이런 고민은 이전부터 하고 있었다. 관련해서 찾아보면 모노레포 아키텍쳐 관련한 내용을 찾아볼 수 있었는데 우리의 경우 프론트와 백엔드를 공유하는 내용이 없어서 시도는 하지 못했었다. 그러다가 새로운 프로젝트를 진행하는데 이번에도 동일한 인터페이스를 프론트, 백엔드에서 재정의하는 것을 보고 프로젝트 구성 방식을 모노레포로 변경해보기로 하였다.      

이번 프로젝트의 기술 스택은 프론트는 React, 백엔드는 NestJS로 둘 다 타입스크립트 기반으로 되어있다.         

모노레포 전환을 위해 관리를 도와주는 툴을 찾아보는데 나는 turbo를 이용하여 모노레포 구성을 하기로 하였다.

[turbo 공식 문서](https://turbo.build/)

다른 툴도 있었지만 turbo를 선택한 이유는 기본적으로 타입스크립트를 지원하는거에 있어서 큰 이점이 있을 것 같다라는 생각이 들었다. (사실 이 이유밖에 없다..ㅎㅎㅎ)


## 모노레포란?

그렇다면 모노레포란 무엇일까? 

2 개 이상의 프로젝트 코드를 하나의 레포지토리에서 관리하는 방법을 의미한다.

### 특징

- 단일 코드 저장소
  - 모든 소스 코드를 단일 코드 저장소에 유지
- 모듈화
  - 코드를 모듈화하여 필요한 모듈만 가져와서 사용할 수 있다.
- 의존성 관리
  - 모든 코드가 단일 코드 저장소에 있기 때문에 의존성 문제를 해결할 수 있다.
- 협업
  - 모든 코드가 단일 코드 저장소에 있기 때문에 다른 개발자들 간의 협업이 편해진다.
- 코드 품질
  - 리펙토링이 필요한 경우 모든 프로젝트의 상황을 고려하기 때문에 코드 품질을 일관성 있게 유지할 수 있다.

### 단점

- 복잡성 증가
  - 여러 프로젝트를 하나의 저장소에 관리하므로 코드 충돌 등의 문제가 발생할 가능성이 높아진다.
- 빌드 시간 증가
  - 모든 프로젝트를 함께 빌드해야 하므로 빌드 시간이 증가할 수 있다.
- 변경 사항이 모든 프로젝트에 영향을 미침
  - 하나의 프로젝트에서 발생한 변경 사항이 전체 시스템에 영향을 미칠 수 있다.

<br/>

단점을 보았을 때 진행하는 프로젝트와는 거리가 먼 것처럼 다가왔다. 프로젝트 규모가 엄청 큰 것도 아니기도 했고 많은 파일을 공유할게 아니기 때문에 큰 영향을 주지 않을 것이라고 생각했다.


## 프로젝트에 적용해보기

모노레포를 도입하기로 한 주된 목적은 우선 **프론트와 백엔드 간의 인터페이스 공유**이다. Request, Response 하는 데이터 타입은 프론트와 백엔드가 일치하므로 인터페이스를 공유할 수 있을 것 같았다.  

하지만 백엔드에서는 dto 체크를 위해 class-validator를 사용한 class 기반 dto를 사용하고 프론트는 인터페이스 만으로 타입 체크를 하고 있는데 이 둘을 어떻게 일치시킬지 고민이 되었다.

1. 프론트와 백엔드 둘 다 class 기반으로 타입을 체크한다.
2. 인터페이스를 작성하고 프론트에서 해당 인터페이스를 사용하고, 백엔드에서는 해당 인터페이스를 구현받아 class-validator 기반 dto로 재정의한다.

첫 번째 class 기반으로 타입체크는 프론트와 백엔드간의 파일 공유가 되지 않아 실패하였다... (아마 모듈 문제인가..?)

최종적으로는 두 번째인 인터페이스를 구현받아 재정의하는 방향으로 하였다.


최종으로 구축한 프로젝트 구조는 아래와 같이 되어있다.

![monorepo]({{site.baseurl}}/assets/img/posts/2024/05/02/project1.png)

(* 팀 내에서 프론트와 백엔드의 디렉토리명을 frontend, backend로 관리하고 있어 다른 예제의 경우와 다를 수 있다.)




